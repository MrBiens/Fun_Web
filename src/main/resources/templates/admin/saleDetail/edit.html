<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">
<head th:replace="admin/fragments/head :: head">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
</head>
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">

    <header th:replace="admin/fragments/header :: header"> </header>
    <!-- =============================================== -->

    <!-- Left side column. contains the sidebar -->
    <aside th:replace="admin/fragments/sidebar :: sidebar"></aside>
    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Blank page
                <small>it all starts here</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                <li><a href="#">Examples</a></li>
                <li class="active">Blank page</li>
            </ol>
        </section>

        <!-- Main content -->
        <section class="content">

            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">Quick Example</h3>
                </div>

                <form role="form" method="post" th:action="@{/admin/sale-detail/edit}" th:object="${request}" >

                    <div class="box-body">
                        <input type="hidden" th:field="*{saleInvoiceId}"  />

                        <div class="form-group">
                            <label for="productName">Product Name</label>
                            <input type="text" id="productName" name="productName" class="form-control" placeholder="Search product" autocomplete="off" oninput="search_product()">
                            <ul id="productList" class="dropdown-menu" style="display: none; position: absolute;"></ul>
                        </div>

                        <div class="form-group">
                            <label>Quantity</label>
                            <input type="number" th:field="*{quantity}" class="form-control" placeholder="Quantity">
                        </div>

                        <div class="form-group">
                            <label>Price</label>
                            <input type="number" th:field="*{price}" class="form-control" placeholder="Price">
                        </div>

                        <!-- Trường ẩn để lưu ID sản phẩm -->
                        <input id="productId" name="productId" type="hidden" th:field="*{productId}"  />

                    </div>

                    <div class="box-footer">
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>

                </form>
            </div>

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <footer th:replace="admin/fragments/footer :: footer"></footer>

</div>
<!-- ./wrapper -->

<!-- jQuery 3 -->
<div th:replace="admin/fragments/script :: script"></div>

<script>
    const apiBaseUrl = '/admin/product';

    function search_product() {
        let keySearch = document.getElementById("productName").value;
        if (keySearch.length >= 2) {
            $.ajax({
                url: apiBaseUrl + "/autocomplete?term=" + keySearch,
                method: 'GET',
                success: function(result) {
                    let productList = $("#productList");
                    productList.empty();  // Clear previous results
                    if (result.length > 0) {
                        productList.show();
                        result.forEach(item => {
                            productList.append(`<li class="dropdown-item" onclick="selectProduct('${item.label}', ${item.value})">${item.label}</li>`);
                        });
                    } else {
                        productList.hide();
                    }
                },
                error: function(error) {
                    console.log("Error:", error);
                }
            });
        } else {
            $("#productList").hide();
        }
    }

    function selectProduct(label, value) {
        $("#productName").val(label);
        $("#productId").val(value);
        $("#productList").hide();  // Hide the dropdown after selecting
    }
</script>

</body>
</html>